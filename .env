import express from 'express'
import cors from 'cors'
import axios from 'axios'

const app = express()
app.use(cors())

const SHEET_URL = 'https://opensheet.elk.sh/SHEET_ID/Sheet1'

app.get('/producto', async (req, res) => {
  const { codigo } = req.query
  if (!codigo) return res.status(400).json({ error: 'CÃ³digo requerido' })

  try {
    const response = await axios.get(SHEET_URL)
    const data = response.data

    const found = data.find(row => row.codigo === codigo)

    if (!found) return res.status(404).json({ error: 'No encontrado' })

    res.json({
      proveedor: found.proveedor,
      precioProveedor: found.precio_proveedor,
      precioVenta: found.precio_venta,
    })
  } catch (e) {
    res.status(500).json({ error: 'Error leyendo datos' })
  }
})

app.listen(3001, () => console.log('Backend listo'))
